<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Le Plein Malin</title>
    
    <!-- Tailwind CSS (via CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons (via CDN) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800;900&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Animations personnalis√©es */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        .animate-float {
            animation: float 6s ease-in-out infinite;
        }

        /* Jauge Aiguille Transition */
        #needle {
            transition: transform 0.1s cubic-bezier(0.4, 0, 0.2, 1);
            transform-origin: bottom center;
        }

        /* Masquer la scrollbar tout en gardant le scroll */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 overflow-hidden h-screen w-screen">

    <!-- ==================== VUE 1 : S√âLECTION (Selection View) ==================== -->
    <div id="view-selection" class="h-full w-full relative overflow-y-auto no-scrollbar bg-slate-50 transition-opacity duration-300">
        
        <!-- Background Blobs -->
        <div class="fixed top-0 right-0 w-64 h-64 bg-blue-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 -translate-y-1/2 translate-x-1/2 pointer-events-none"></div>
        <div class="fixed top-40 left-0 w-72 h-72 bg-purple-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 -translate-x-1/2 pointer-events-none"></div>

        <div class="relative z-10 px-6 pt-8 pb-20">
            <header class="mb-8">
                <h1 class="text-3xl font-extrabold text-slate-900 leading-tight">
                    Bonjour, <br/>
                    <span class="text-blue-600">Quel v√©hicule ?</span>
                </h1>
                <p class="text-slate-400 text-sm mt-2 font-medium">S√©lectionnez votre mod√®le pour un calcul pr√©cis.</p>
            </header>

            <!-- Search Bar Floating -->
            <div class="sticky top-4 z-50 mb-8 flex gap-2">
                <div class="flex-1 bg-white/90 backdrop-blur-lg rounded-2xl shadow-lg shadow-slate-200/50 p-1 flex items-center border border-slate-100">
                    <div class="p-3">
                        <i data-lucide="search" class="w-5 h-5 text-slate-400"></i>
                    </div>
                    <input
                        type="text"
                        id="search-input"
                        placeholder="Rechercher (ex: Changan, Corolla...)"
                        class="w-full bg-transparent p-2 outline-none text-slate-700 font-medium placeholder-slate-300"
                    />
                </div>
            </div>

            <!-- Liste des v√©hicules -->
            <div class="space-y-8" id="vehicle-list-container">
                
                <!-- Bouton Ajout Manuel -->
                <div onclick="openModal()" class="bg-gradient-to-r from-blue-600 to-indigo-600 rounded-2xl p-4 shadow-lg shadow-blue-200 text-white flex items-center justify-between cursor-pointer active:scale-95 transition-transform">
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center">
                            <i data-lucide="plus" class="w-6 h-6 text-white"></i>
                        </div>
                        <div>
                            <h3 class="font-bold">V√©hicule non list√© ?</h3>
                            <p class="text-xs text-blue-100 opacity-80">Configuration manuelle</p>
                        </div>
                    </div>
                    <i data-lucide="chevron-right" class="w-5 h-5 opacity-50"></i>
                </div>

                <!-- Conteneur g√©n√©r√© par JS -->
                <div id="dynamic-list"></div>
                
                <!-- √âtat vide -->
                <div id="empty-state" class="hidden text-center py-10 opacity-50">
                    <i data-lucide="car" class="w-12 h-12 mx-auto mb-2 text-slate-300"></i>
                    <p>Aucun v√©hicule trouv√©.</p>
                </div>

            </div>
        </div>
    </div>

    <!-- ==================== VUE 2 : CALCULATEUR (Calculator View) ==================== -->
    <div id="view-calculator" class="hidden h-full w-full bg-slate-900 text-white relative overflow-hidden flex flex-col transition-opacity duration-300">
        
        <!-- Dynamic Background -->
        <div class="absolute top-0 left-0 w-full h-[50vh] bg-gradient-to-b from-blue-900 to-slate-900 z-0"></div>
        <div class="absolute -top-20 -right-20 w-80 h-80 bg-blue-600 rounded-full blur-[100px] opacity-20 animate-float"></div>

        <div class="relative z-10 px-5 pt-6 flex flex-col h-full flex-grow">
            
            <!-- Navigation Header -->
            <div class="flex items-center justify-between mb-4">
                <button onclick="switchView('selection')" class="w-10 h-10 rounded-full bg-white/10 backdrop-blur-md flex items-center justify-center border border-white/10 active:scale-95 transition-transform">
                    <i data-lucide="arrow-left" class="w-5 h-5 text-white"></i>
                </button>
                <div class="flex flex-col items-end">
                    <span class="text-xs text-blue-300 font-medium uppercase tracking-wider">V√©hicule</span>
                    <span id="calc-vehicle-name" class="font-bold text-lg">Toyota Corolla</span>
                </div>
            </div>

            <!-- JAUGE INTERACTIVE -->
            <div class="mb-6 flex-grow-0">
                <div class="bg-slate-800/50 backdrop-blur-sm rounded-[2rem] p-4 border border-white/5 shadow-2xl relative overflow-hidden">
                    <div class="text-center mb-2">
                        <span class="text-xs text-blue-300 font-medium uppercase tracking-wider flex items-center justify-center gap-1">
                           <i data-lucide="zap" class="w-3 h-3"></i> Touchez la jauge
                        </span>
                    </div>

                    <!-- SVG GAUGE CONTAINER -->
                    <div id="gauge-container" class="mx-auto max-w-[300px] relative aspect-[2/1] select-none touch-none cursor-pointer">
                        <svg viewBox="0 0 300 160" class="w-full h-full overflow-visible pointer-events-none">
                            <path d="M 30 150 A 120 120 0 0 1 270 150" fill="none" stroke="#334155" stroke-width="15" stroke-linecap="round"></path>
                            <path d="M 30 150 A 120 120 0 0 1 65 95" fill="none" stroke="#ef4444" stroke-width="15" stroke-linecap="round" opacity="0.8"></path>
                            
                            <!-- Ticks -->
                            <line x1="20" y1="150" x2="45" y2="150" stroke="#fff" stroke-width="3"></line>
                            <text x="15" y="145" fill="#ef4444" font-size="20" font-weight="bold" text-anchor="end" font-family="sans-serif">E</text>
                            
                            <line x1="150" y1="20" x2="150" y2="45" stroke="#fff" stroke-width="3"></line>
                            <text x="150" y="15" fill="#94a3b8" font-size="16" font-weight="bold" text-anchor="middle" font-family="sans-serif">1/2</text>
                            
                            <line x1="280" y1="150" x2="255" y2="150" stroke="#fff" stroke-width="3"></line>
                            <text x="285" y="145" fill="#fff" font-size="20" font-weight="bold" text-anchor="start" font-family="sans-serif">F</text>
                            
                            <line x1="65" y1="65" x2="82" y2="82" stroke="#64748b" stroke-width="2"></line>
                            <line x1="235" y1="65" x2="218" y2="82" stroke="#64748b" stroke-width="2"></line>
                            
                            <!-- Fuel Icon SVG in Gauge -->
                            <g transform="translate(136, 100) scale(0.8)">
                               <path d="M3 6v15h13V6c0-1.7-1.3-3-3-3h-7c-1.7 0-3 1.3-3 3z" fill="none" stroke="#64748b" stroke-width="2"/>
                               <path d="M16 10h4v6" fill="none" stroke="#64748b" stroke-width="2"/>
                            </g>
                        </svg>

                        <!-- Aiguille (DOM Element) -->
                        <div class="absolute bottom-0 left-1/2 w-0 h-0 pointer-events-none">
                            <div id="needle" class="w-1 h-32 bg-red-500 origin-bottom rounded-full shadow-[0_0_10px_rgba(239,68,68,0.8)] absolute bottom-0 -left-0.5" style="transform: rotate(-45deg);">
                                <div class="absolute -bottom-3 -left-3 w-7 h-7 bg-slate-200 rounded-full border-4 border-slate-800 shadow-lg"></div>
                            </div>
                        </div>
                        
                        <!-- Invisible Hitbox -->
                        <div class="absolute inset-0"></div>
                    </div>

                    <div class="text-center mt-2 relative z-20">
                        <div class="inline-block bg-slate-900/80 px-4 py-1 rounded-full border border-white/10">
                          <span id="gauge-text" class="text-2xl font-black tracking-tighter text-white">25</span>
                          <span class="text-sm text-slate-400 font-light ml-1">%</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- S√âLECTEUR DE PRIX -->
            <div class="bg-slate-800/30 rounded-2xl p-2 mb-6 flex gap-2 border border-white/5 flex-grow-0">
                <button onclick="setPrice(875)" id="btn-super" class="flex-1 py-3 px-4 rounded-xl flex items-center justify-center gap-2 transition-all bg-gradient-to-r from-orange-500 to-amber-500 text-white shadow-lg shadow-orange-500/20">
                    <i data-lucide="fuel" class="w-4 h-4"></i>
                    <div class="text-left leading-none">
                        <span class="block text-xs opacity-80">Super</span>
                        <span class="font-bold">875 F</span>
                    </div>
                </button>
                <button onclick="setPrice(715)" id="btn-gasoil" class="flex-1 py-3 px-4 rounded-xl flex items-center justify-center gap-2 transition-all text-slate-400 hover:bg-white/5">
                    <i data-lucide="truck" class="w-4 h-4"></i>
                    <div class="text-left leading-none">
                        <span class="block text-xs opacity-80">Gasoil</span>
                        <span class="font-bold">715 F</span>
                    </div>
                </button>
            </div>

            <!-- TICKET DE R√âSULTAT -->
            <div class="mt-auto">
                <div class="relative">
                    <!-- D√©coration Ticket Top -->
                    <div class="absolute -top-2 left-0 w-full h-4 bg-slate-900 z-20 rounded-b-xl"></div>
                    
                    <div class="bg-gradient-to-br from-white to-blue-50 rounded-t-3xl p-6 text-slate-900 shadow-[0_-10px_40px_rgba(0,0,0,0.3)] pb-8">
                        <!-- Ligne pointill√©e -->
                        <div class="absolute top-0 left-1/2 -translate-x-1/2 -translate-y-1/2 w-12 h-1 bg-slate-300 rounded-full"></div>

                        <div class="flex justify-between items-end mb-2">
                            <span class="text-sm text-slate-500 font-bold uppercase tracking-wider">Montant √† payer</span>
                            <div class="flex items-center gap-1 bg-blue-100 text-blue-700 px-2 py-1 rounded text-xs font-bold">
                                <i data-lucide="droplets" class="w-3 h-3"></i>
                                <span id="res-liters">0.0</span> L manquants
                            </div>
                        </div>
                        
                        <div class="flex items-baseline mb-4">
                            <span id="res-cost" class="text-5xl font-black text-slate-900 tracking-tight">0</span>
                            <span class="text-lg font-bold text-slate-400 ml-1">FCFA</span>
                        </div>
                        
                        <!-- Actions Rapides -->
                        <div class="grid grid-cols-2 gap-3 mt-4">
                            <button onclick="shareResult()" class="flex items-center justify-center gap-2 bg-green-500 text-white py-3 rounded-xl font-bold active:scale-95 transition-transform shadow-lg shadow-green-500/20">
                                <i data-lucide="share-2" class="w-5 h-5"></i>
                                WhatsApp
                            </button>
                            <button onclick="openMaps()" class="flex items-center justify-center gap-2 bg-slate-200 text-slate-700 py-3 rounded-xl font-bold active:scale-95 transition-transform">
                                <i data-lucide="map-pin" class="w-5 h-5"></i>
                                Station
                            </button>
                        </div>

                        <div class="mt-4 pt-4 border-t border-slate-200 text-center">
                            <p class="text-xs text-slate-500 font-medium">Autonomie estim√©e: +<span id="res-distance">0</span> km</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== MODAL : AJOUT V√âHICULE ==================== -->
    <div id="modal-manual" class="hidden fixed inset-0 z-[60] bg-slate-900/50 backdrop-blur-sm flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl p-6 w-full max-w-sm shadow-2xl animate-[float_0.3s_ease-out]">
            <h3 class="text-xl font-bold mb-4 flex items-center gap-2 text-slate-800">
                <i data-lucide="plus" class="w-6 h-6 text-blue-600"></i> Configurer mon v√©hicule
            </h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-xs font-bold text-slate-400 uppercase mb-1">Nom (ex: Ma BMW)</label>
                    <input type="text" id="manual-name" class="w-full bg-slate-100 p-3 rounded-xl font-bold text-slate-800 outline-blue-500" placeholder="Nom du v√©hicule">
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-xs font-bold text-slate-400 uppercase mb-1">R√©servoir (L)</label>
                        <input type="number" id="manual-capacity" class="w-full bg-slate-100 p-3 rounded-xl font-bold text-slate-800 outline-blue-500 text-lg" placeholder="ex: 60">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-400 uppercase mb-1">Conso (L/100)</label>
                        <input type="number" id="manual-consumption" class="w-full bg-slate-100 p-3 rounded-xl font-bold text-slate-800 outline-blue-500 text-lg" placeholder="ex: 12" value="12">
                    </div>
                </div>
                
                <div class="flex gap-3 pt-2">
                    <button onclick="closeModal()" class="flex-1 py-3 text-slate-500 font-bold">Annuler</button>
                    <button onclick="submitManual()" class="flex-1 py-3 bg-blue-600 text-white rounded-xl font-bold shadow-lg shadow-blue-200">Valider</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== JAVASCRIPT LOGIC ==================== -->
    <script>
        // --- DONN√âES MISES √Ä JOUR (Consommations R√©alistes Afrique) ---
        const VEHICLE_DB = [
            // Nouvel Ajout Sp√©cifique
            { id: 'chan_cs75', brand: 'Changan', model: 'CS75 Plus', type: 'SUV', capacity: 58, consumption: 14.3 }, // Calibr√© sur ~405km/plein

            { id: 'moto_bajaj', brand: 'Bajaj', model: 'Boxer BM 150', type: 'Moto', capacity: 11, consumption: 3.0 },
            { id: 'moto_tvs', brand: 'TVS', model: 'Apache / Neo', type: 'Moto', capacity: 10, consumption: 3.0 },
            { id: 'suz_alto', brand: 'Suzuki', model: 'Alto / S-Presso', type: 'Citadine', capacity: 27, consumption: 5.5 },
            { id: 'toy_yaris', brand: 'Toyota', model: 'Yaris / Vitz', type: 'Citadine', capacity: 42, consumption: 7.5 },
            { id: 'toy_corolla', brand: 'Toyota', model: 'Corolla / Allex', type: 'Berline', capacity: 50, consumption: 9.0 },
            { id: 'peug_301', brand: 'Peugeot', model: '301 / C-Elys√©e', type: 'Berline', capacity: 50, consumption: 8.0 },
            { id: 'hyun_elantra', brand: 'Hyundai', model: 'Elantra', type: 'Berline', capacity: 50, consumption: 9.0 },
            { id: 'toy_avensis', brand: 'Toyota', model: 'Avensis', type: 'Berline', capacity: 60, consumption: 10.0 },
            { id: 'mer_c', brand: 'Mercedes', model: 'Classe C', type: 'Berline', capacity: 66, consumption: 10.5 },
            { id: 'mer_e', brand: 'Mercedes', model: 'Classe E', type: 'Berline', capacity: 80, consumption: 11.5 },
            { id: 'mer_190', brand: 'Mercedes', model: '190 (W201)', type: 'Berline', capacity: 55, consumption: 10.0 },
            { id: 'peug_406', brand: 'Peugeot', model: '406 / 407', type: 'Berline', capacity: 70, consumption: 9.5 },
            { id: 'ren_duster', brand: 'Renault', model: 'Duster', type: 'SUV', capacity: 50, consumption: 9.0 },
            { id: 'toy_rav4', brand: 'Toyota', model: 'RAV4', type: 'SUV', capacity: 60, consumption: 11.0 },
            { id: 'hyun_tucson', brand: 'Hyundai', model: 'Tucson / ix35', type: 'SUV', capacity: 58, consumption: 11.5 },
            { id: 'kia_sportage', brand: 'Kia', model: 'Sportage', type: 'SUV', capacity: 62, consumption: 11.5 },
            { id: 'nis_qashqai', brand: 'Nissan', model: 'Qashqai', type: 'SUV', capacity: 65, consumption: 9.0 },
            { id: 'suz_vitara', brand: 'Suzuki', model: 'Grand Vitara', type: 'SUV', capacity: 66, consumption: 10.5 },
            { id: 'toy_hilux', brand: 'Toyota', model: 'Hilux (Double Cab)', type: 'Pick-up', capacity: 80, consumption: 12.0 },
            { id: 'mits_l200', brand: 'Mitsubishi', model: 'L200 / Triton', type: 'Pick-up', capacity: 75, consumption: 12.0 },
            { id: 'ford_ranger', brand: 'Ford', model: 'Ranger', type: 'Pick-up', capacity: 80, consumption: 12.5 },
            { id: 'toy_prado', brand: 'Toyota', model: 'Land Cruiser Prado', type: '4x4', capacity: 87, consumption: 14.0 },
            { id: 'toy_v8', brand: 'Toyota', model: 'Land Cruiser V8', type: '4x4', capacity: 93, consumption: 17.0 },
            { id: 'nis_patrol', brand: 'Nissan', model: 'Patrol', type: '4x4', capacity: 95, consumption: 18.0 },
            { id: 'toy_hiace', brand: 'Toyota', model: 'HiAce (Gbaka)', type: 'Utilitaire', capacity: 70, consumption: 13.0 },
            { id: 'mer_sprinter', brand: 'Mercedes', model: 'Sprinter', type: 'Utilitaire', capacity: 75, consumption: 14.0 },
        ];

        const CATEGORIES = [
            { id: 'moto', label: 'Motos', types: ['Moto'], icon: 'bike', color: 'text-orange-500', bg: 'bg-orange-500/10' },
            { id: 'city', label: 'Citadines & Berlines', types: ['Citadine', 'Berline'], icon: 'car', color: 'text-blue-500', bg: 'bg-blue-500/10' },
            { id: 'suv', label: 'SUV & 4x4', types: ['SUV', '4x4', 'Pick-up'], icon: 'droplets', color: 'text-teal-500', bg: 'bg-teal-500/10' },
            { id: 'util', label: 'Utilitaires', types: ['Utilitaire'], icon: 'bus', color: 'text-purple-500', bg: 'bg-purple-500/10' },
        ];

        // --- STATE ---
        let state = {
            selectedVehicle: null,
            currentLevel: 25,
            fuelPrice: 875
        };

        // --- NAVIGATION ---
        function switchView(viewName) {
            const selectionEl = document.getElementById('view-selection');
            const calculatorEl = document.getElementById('view-calculator');
            
            if (viewName === 'calculator') {
                selectionEl.classList.add('hidden');
                calculatorEl.classList.remove('hidden');
                updateCalculatorUI();
            } else {
                selectionEl.classList.remove('hidden');
                calculatorEl.classList.add('hidden');
            }
        }

        function openModal() {
            document.getElementById('modal-manual').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('modal-manual').classList.add('hidden');
            // Reset fields
            document.getElementById('manual-name').value = '';
            document.getElementById('manual-capacity').value = '';
            document.getElementById('manual-consumption').value = '12';
        }

        // --- LOGIQUE METIER ---
        
        // 1. Rendu de la liste
        function renderVehicleList(filter = "") {
            const container = document.getElementById('dynamic-list');
            const emptyState = document.getElementById('empty-state');
            container.innerHTML = '';
            
            let hasResults = false;
            const searchTerm = filter.toLowerCase();

            // Filtrer globalement d'abord
            const filteredDB = VEHICLE_DB.filter(v => 
                v.brand.toLowerCase().includes(searchTerm) || 
                v.model.toLowerCase().includes(searchTerm)
            );

            if (filteredDB.length === 0) {
                emptyState.classList.remove('hidden');
                return;
            } else {
                emptyState.classList.add('hidden');
            }

            CATEGORIES.forEach(cat => {
                const catVehicles = filteredDB.filter(v => cat.types.includes(v.type));
                
                if (catVehicles.length > 0) {
                    hasResults = true;
                    // Titre Cat√©gorie
                    const titleDiv = document.createElement('div');
                    titleDiv.className = 'flex items-center gap-2 mb-4 opacity-80 mt-6 first:mt-0';
                    titleDiv.innerHTML = `
                        <span class="p-1.5 rounded-lg ${cat.bg} ${cat.color}">
                            <i data-lucide="${cat.icon}" class="w-4 h-4"></i>
                        </span>
                        <h2 class="text-xs font-bold text-slate-500 uppercase tracking-widest">${cat.label}</h2>
                    `;
                    container.appendChild(titleDiv);

                    // Grid V√©hicules
                    const gridDiv = document.createElement('div');
                    gridDiv.className = 'grid gap-3';
                    
                    catVehicles.forEach(vehicle => {
                        const card = document.createElement('div');
                        card.className = 'group bg-white rounded-2xl p-4 shadow-sm border border-slate-100 hover:border-blue-500 hover:shadow-md transition-all duration-300 cursor-pointer flex items-center justify-between active:scale-[0.98]';
                        card.onclick = () => selectVehicle(vehicle);
                        card.innerHTML = `
                            <div class="flex items-center gap-4">
                                <div class="w-10 h-10 rounded-full bg-slate-50 flex items-center justify-center text-slate-400 group-hover:bg-blue-600 group-hover:text-white transition-colors">
                                    <span class="font-bold text-xs">${vehicle.brand.substring(0,1)}</span>
                                </div>
                                <div>
                                    <h3 class="font-bold text-slate-800">${vehicle.model}</h3>
                                    <p class="text-xs text-slate-400 font-medium">${vehicle.brand} ‚Ä¢ ${vehicle.capacity}L</p>
                                </div>
                            </div>
                            <div class="w-8 h-8 rounded-full border border-slate-100 flex items-center justify-center group-hover:border-blue-500 group-hover:bg-blue-50 transition-all">
                                <i data-lucide="chevron-right" class="w-4 h-4 text-slate-300 group-hover:text-blue-600"></i>
                            </div>
                        `;
                        gridDiv.appendChild(card);
                    });
                    container.appendChild(gridDiv);
                }
            });
            
            // Re-render icons
            lucide.createIcons();
        }

        // 2. S√©lection
        function selectVehicle(vehicle) {
            state.selectedVehicle = vehicle;
            switchView('calculator');
        }

        function submitManual() {
            const name = document.getElementById('manual-name').value;
            const cap = parseFloat(document.getElementById('manual-capacity').value);
            const cons = parseFloat(document.getElementById('manual-consumption').value);

            if (name && cap > 0) {
                const customVehicle = {
                    id: 'custom_' + Date.now(),
                    brand: name,
                    model: '(Perso)',
                    type: 'Autre',
                    capacity: cap,
                    consumption: cons > 0 ? cons : 12 // Utilisation de la conso d√©finie ou 12 par d√©faut
                };
                state.selectedVehicle = customVehicle;
                closeModal();
                switchView('calculator');
            } else {
                alert("Veuillez entrer un nom et une capacit√© valide.");
            }
        }

        // 3. Logique de Calcul
        function updateCalculatorUI() {
            if (!state.selectedVehicle) return;

            // Header
            document.getElementById('calc-vehicle-name').innerText = `${state.selectedVehicle.brand} ${state.selectedVehicle.model}`;
            
            // Calculs
            const litersToFill = state.selectedVehicle.capacity - ((state.selectedVehicle.capacity * state.currentLevel) / 100);
            const cost = litersToFill * state.fuelPrice;
            const distance = (litersToFill / state.selectedVehicle.consumption) * 100;

            // MAJ DOM
            document.getElementById('res-liters').innerText = litersToFill.toFixed(1);
            document.getElementById('res-cost').innerText = new Intl.NumberFormat('fr-FR').format(Math.round(cost));
            document.getElementById('res-distance').innerText = Math.round(distance);

            // Prix Boutons Style
            const btnSuper = document.getElementById('btn-super');
            const btnGasoil = document.getElementById('btn-gasoil');
            
            if (state.fuelPrice === 875) {
                btnSuper.className = "flex-1 py-3 px-4 rounded-xl flex items-center justify-center gap-2 transition-all bg-gradient-to-r from-orange-500 to-amber-500 text-white shadow-lg shadow-orange-500/20";
                btnGasoil.className = "flex-1 py-3 px-4 rounded-xl flex items-center justify-center gap-2 transition-all text-slate-400 hover:bg-white/5";
            } else {
                btnSuper.className = "flex-1 py-3 px-4 rounded-xl flex items-center justify-center gap-2 transition-all text-slate-400 hover:bg-white/5";
                btnGasoil.className = "flex-1 py-3 px-4 rounded-xl flex items-center justify-center gap-2 transition-all bg-gradient-to-r from-gray-700 to-slate-600 text-white shadow-lg";
            }

            // MAJ Jauge Visuelle
            updateGaugeVisuals();
        }

        function setPrice(price) {
            state.fuelPrice = price;
            updateCalculatorUI();
        }

        // 4. Jauge Interactive Logic
        const gaugeContainer = document.getElementById('gauge-container');
        let isDragging = false;

        function updateGaugeFromEvent(clientX, clientY) {
            const rect = gaugeContainer.getBoundingClientRect();
            const cx = rect.left + rect.width / 2;
            const cy = rect.top + rect.height - 10;
            const x = clientX - cx;
            const y = clientY - cy;
            
            let angle = Math.atan2(y, x);
            let percent = 0;
            
            // Mapping de l'angle √† 0-100%
            if (angle > 0) {
                percent = x < 0 ? 0 : 1;
            } else {
                // angle est entre -PI (gauche) et 0 (droite)
                // -PI => 0%, 0 => 100%
                percent = 1 - (angle / -Math.PI);
            }
            
            percent = Math.max(0, Math.min(1, percent));
            state.currentLevel = Math.round(percent * 100);
            updateCalculatorUI();
        }

        function updateGaugeVisuals() {
            const percent = state.currentLevel;
            document.getElementById('gauge-text').innerText = percent;
            
            // Rotation: 0% = -90deg, 100% = 90deg
            const rotation = -90 + (percent / 100) * 180;
            document.getElementById('needle').style.transform = `rotate(${rotation}deg)`;
        }

        // Listeners Jauge
        const startDrag = (e) => {
            isDragging = true;
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            updateGaugeFromEvent(clientX, clientY);
        };
        const moveDrag = (e) => {
            if (!isDragging) return;
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            updateGaugeFromEvent(clientX, clientY);
        };
        const endDrag = () => { isDragging = false; };

        gaugeContainer.addEventListener('mousedown', startDrag);
        gaugeContainer.addEventListener('touchstart', startDrag, {passive: false}); // passive: false pour pr√©venir le scroll si besoin
        
        window.addEventListener('mousemove', moveDrag);
        window.addEventListener('touchmove', moveDrag, {passive: false});
        
        window.addEventListener('mouseup', endDrag);
        window.addEventListener('touchend', endDrag);

        // 5. Actions Externes
        function shareResult() {
            if (!state.selectedVehicle) return;
            const liters = (state.selectedVehicle.capacity - ((state.selectedVehicle.capacity * state.currentLevel) / 100)).toFixed(1);
            const cost = new Intl.NumberFormat('fr-FR').format(Math.round(liters * state.fuelPrice));
            
            const text = `‚õΩ *Le Plein Malin*\n\nüöó V√©hicule: ${state.selectedVehicle.brand} ${state.selectedVehicle.model}\nüìä Jauge: ${state.currentLevel}%\nüíß Manque: ${liters} L\nüí∞ *Co√ªt estim√©: ${cost} FCFA*\n\nCalcul√© avec Le Plein Malin.`;
            const url = `https://wa.me/?text=${encodeURIComponent(text)}`;
            window.open(url, '_blank');
        }

        function openMaps() {
            window.open('https://www.google.com/maps/search/station+service+proche', '_blank');
        }

        // 6. Search Listener
        document.getElementById('search-input').addEventListener('input', (e) => {
            renderVehicleList(e.target.value);
        });

        // --- INIT ---
        window.onload = () => {
            renderVehicleList();
            lucide.createIcons();
            
            // Emp√™cher le pull-to-refresh sur mobile qui g√¢che l'UX
            document.body.addEventListener('touchmove', function(e) { 
                if (isDragging) e.preventDefault();
            }, { passive: false });
        };

    </script>
</body>
</html>
